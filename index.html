<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZONA GAMER XDR - APP</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILO CYBERPUNK BASE --- */
        :root {
            --neon-red: #ff003c;
            --neon-blue: #00f0ff;
            --neon-green: #39ff14;
            --neon-purple: #bc13fe;
            --bg-dark: #050505;
            --card-bg: #111;
        }
        body {
            background-color: var(--bg-dark);
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            margin: 0;
            padding-bottom: 90px; /* Espacio para barra inferior */
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        /* Fondo Scanline */
        body::before {
            content: " "; display: block; position: fixed; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: -1; background-size: 100% 2px, 3px 100%; pointer-events: none;
            animation: scanline 10s linear infinite;
        }
        @keyframes scanline { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }

        /* --- NAVEGACI√ìN (TABS) --- */
        .nav-tabs {
            display: flex; justify-content: space-around; background: rgba(0,0,0,0.9);
            border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100;
            backdrop-filter: blur(10px);
        }
        .tab-btn {
            background: none; border: none; color: #666; font-family: 'Orbitron';
            font-size: 0.8rem; padding: 15px 10px; cursor: pointer; transition: 0.3s;
            border-bottom: 3px solid transparent; width: 33%;
        }
        .tab-btn.active {
            color: #fff; border-bottom-color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
        }

        /* --- SECCIONES --- */
        .section-view { display: none; padding: 15px; animation: fadeIn 0.4s ease; max-width: 1000px; margin: 0 auto; }
        .section-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { font-family: 'Orbitron'; color: var(--neon-blue); margin-top: 0; font-size: 1.2rem; border-left: 4px solid var(--neon-blue); padding-left: 10px; }

        /* --- ESTILOS COMIDA --- */
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; }
        .food-card {
            background: var(--card-bg); border: 1px solid #333; border-radius: 6px; overflow: hidden; position: relative;
        }
        .food-card.selected { border-color: var(--neon-green); box-shadow: 0 0 10px rgba(57, 255, 20, 0.3); }
        .food-img { width: 100%; height: 100px; object-fit: cover; background: #000; }
        .food-info { padding: 8px; }
        .food-title { font-weight: bold; font-size: 0.9rem; line-height: 1.1; margin-bottom: 5px; }
        .food-price { color: var(--neon-green); font-family: 'Orbitron'; }
        .badge { position: absolute; top: 0; right: 0; background: var(--neon-green); color: #000; padding: 2px 6px; font-weight: bold; display: none; }

        /* --- ESTILOS ESTACIONES --- */
        .station-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .station-card {
            background: #0f0f0f; border: 1px solid var(--neon-purple); border-radius: 8px;
            padding: 15px; text-align: center; transition: 0.2s;
        }
        .station-card:active { transform: scale(0.98); background: #1a051a; }
        .icon-pc { font-size: 2rem; margin-bottom: 5px; display: block; }
        .st-name { font-family: 'Orbitron'; color: var(--neon-purple); font-weight: bold; }
        .btn-reserve-sm {
            margin-top: 10px; background: transparent; border: 1px solid var(--neon-purple);
            color: #fff; width: 100%; padding: 5px; cursor: pointer;
        }

        /* --- ESTILOS EVENTOS --- */
        .event-card {
            background: #111; border-left: 4px solid var(--neon-red); margin-bottom: 15px; padding: 15px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .date-box { background: #222; padding: 5px 10px; text-align: center; border-radius: 4px; margin-right: 10px; }
        .d-day { font-size: 1.2rem; font-weight: bold; display: block; }
        .d-month { font-size: 0.7rem; color: var(--neon-red); }
        .btn-join {
            background: var(--neon-red); color: #fff; border: none; padding: 8px 15px;
            font-family: 'Orbitron'; font-size: 0.8rem; cursor: pointer;
        }

        /* --- BARRA FLOTANTE INFERIOR --- */
        .bottom-action-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #000; border-top: 2px solid var(--neon-blue);
            padding: 15px; display: flex; justify-content: space-between; align-items: center;
            box-sizing: border-box; z-index: 500;
        }
        .action-info { font-size: 0.9rem; color: #888; }
        .action-total { font-family: 'Orbitron'; font-size: 1.3rem; color: var(--neon-green); }
        
        .btn-main-action {
            background: var(--neon-blue); color: #000; border: none;
            padding: 10px 20px; font-family: 'Orbitron'; font-weight: 900;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
            transition: 0.2s;
        }
        .btn-main-action:active { transform: scale(0.95); }

        /* --- MODAL (LA PANTALLA SIGUIENTE) --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 2000;
            justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: #050505; border: 1px solid var(--neon-blue); padding: 25px;
            width: 100%; max-width: 400px; box-shadow: 0 0 30px rgba(0, 240, 255, 0.2);
            position: relative; animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .form-title { font-family: 'Orbitron'; color: var(--neon-blue); margin-top: 0; text-align: center; }
        .form-summary { color: #888; font-size: 0.9rem; margin-bottom: 15px; text-align: center; border-bottom: 1px dashed #333; padding-bottom: 10px; }

        input, select {
            width: 100%; padding: 12px; margin-bottom: 12px;
            background: #111; border: 1px solid #333; color: #fff;
            font-family: 'Rajdhani'; font-size: 1rem; box-sizing: border-box;
        }
        input:focus { border-color: var(--neon-purple); outline: none; }

        .hidden-field { display: none; } /* Para ocultar campos seg√∫n el tipo de reserva */

    </style>
</head>
<body>

    <nav class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('comida')">üçî COMIDA</button>
        <button class="tab-btn" onclick="switchTab('estaciones')">üïπÔ∏è ESTACIONES</button>
        <button class="tab-btn" onclick="switchTab('eventos')">üèÜ EVENTOS</button>
    </nav>

    <section id="tab-comida" class="section-view active">
        <h2>MEN√ö GAMER</h2>
        <div id="menu-container" class="menu-grid">
            <div style="text-align:center; width:100%; color:#666;">Cargando men√∫...</div>
        </div>
    </section>

    <section id="tab-estaciones" class="section-view">
        <h2 style="color:var(--neon-purple); border-color:var(--neon-purple)">RESERVAR PC/CONSOLA</h2>
        <p style="font-size:0.8rem; color:#888;">Selecciona la m√°quina que deseas usar:</p>
        <div class="station-grid">
            <div class="station-card" onclick="prepararReservaEstacion('PC GAMER 01')">
                <span class="icon-pc">üñ•Ô∏è</span>
                <div class="st-name">PC 01</div>
                <div style="color:#666; font-size:0.8rem">RX 580 / 16GB</div>
                <button class="btn-reserve-sm">RESERVAR</button>
            </div>
            <div class="station-card" onclick="prepararReservaEstacion('PC GAMER 02')">
                <span class="icon-pc">üñ•Ô∏è</span>
                <div class="st-name">PC 02</div>
                <div style="color:#666; font-size:0.8rem">RX 580 / 16GB</div>
                <button class="btn-reserve-sm">RESERVAR</button>
            </div>
            <div class="station-card" onclick="prepararReservaEstacion('PS5 PRO')">
                <span class="icon-pc">üéÆ</span>
                <div class="st-name">PS5 PRO</div>
                <div style="color:#666; font-size:0.8rem">4K / HDR</div>
                <button class="btn-reserve-sm">RESERVAR</button>
            </div>
             <div class="station-card" onclick="prepararReservaEstacion('XBOX SERIES')">
                <span class="icon-pc">box</span>
                <div class="st-name">XBOX</div>
                <div style="color:#666; font-size:0.8rem">GAMEPASS</div>
                <button class="btn-reserve-sm">RESERVAR</button>
            </div>
        </div>
    </section>

    <section id="tab-eventos" class="section-view">
        <h2 style="color:var(--neon-red); border-color:var(--neon-red)">PR√ìXIMOS TORNEOS</h2>
        
        <div class="event-card">
            <div style="display:flex; align-items:center">
                <div class="date-box"><span class="d-day">15</span><span class="d-month">FEB</span></div>
                <div>
                    <div style="font-family:'Orbitron'; font-weight:bold;">TORNEO FIFA FC24</div>
                    <div style="font-size:0.8rem; color:#888">Inscripci√≥n: $5</div>
                </div>
            </div>
            <button class="btn-join" onclick="prepararInscripcion('TORNEO FIFA FC24')">UNIRSE</button>
        </div>

        <div class="event-card">
            <div style="display:flex; align-items:center">
                <div class="date-box"><span class="d-day">20</span><span class="d-month">FEB</span></div>
                <div>
                    <div style="font-family:'Orbitron'; font-weight:bold;">WARZONE DUOS</div>
                    <div style="font-size:0.8rem; color:#888">Inscripci√≥n: $10/Equipo</div>
                </div>
            </div>
            <button class="btn-join" onclick="prepararInscripcion('WARZONE DUOS')">UNIRSE</button>
        </div>
    </section>

    <div id="bottom-bar-food" class="bottom-action-bar">
        <div>
            <div class="action-info">Total Comida</div>
            <div id="total-display" class="action-total">$0.00</div>
        </div>
        <button class="btn-main-action" onclick="abrirModalComida()">PEDIR YA</button>
    </div>

    <div id="main-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title" class="form-title">CONFIRMAR</h3>
            <div id="modal-summary" class="form-summary">...</div>

            <div id="extra-fields-station" class="hidden-field">
                <label style="font-size:0.8rem; color:var(--neon-blue)">FECHA Y HORA</label>
                <input type="datetime-local" id="res_fecha">
                <label style="font-size:0.8rem; color:var(--neon-blue)">DURACI√ìN (HORAS)</label>
                <input type="number" id="res_horas" value="1" min="1" max="5">
            </div>

            <label style="font-size:0.8rem; color:#888">TUS DATOS</label>
            <input type="text" id="cli_nombre" placeholder="Nombre Completo">
            <input type="number" id="cli_cedula" placeholder="C√©dula">
            <input type="tel" id="cli_whatsapp" placeholder="WhatsApp (Ej: 0412...)">

            <button id="btn-confirm-send" class="btn-main-action" style="width:100%; background:var(--neon-green);" onclick="enviarDatosCentral()">ENVIAR</button>
            <button onclick="cerrarModal()" style="width:100%; background:none; border:none; color:#666; margin-top:10px; cursor:pointer;">CANCELAR</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // TU CONFIGURACI√ìN EXACTA
        const firebaseConfig = {
            apiKey: "AIzaSyCtraghFl9rZ0TvtvIZEljto1OYwH5SLo0",
            authDomain: "xdr-zone-server.firebaseapp.com",
            databaseURL: "https://xdr-zone-server-default-rtdb.firebaseio.com",
            projectId: "xdr-zone-server",
            storageBucket: "xdr-zone-server.firebasestorage.app",
            messagingSenderId: "267904397463",
            appId: "1:267904397463:web:93f4bd9c036769777479d2"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ESTADO GLOBAL
        let carrito = {};
        let menuData = {};
        let currentMode = 'comida'; // comida | estacion | evento
        let contextData = null; // Datos temporales (ej: nombre PC)

        // --- 1. L√ìGICA DE NAVEGACI√ìN ---
        window.switchTab = (tabName) => {
            // Ocultar todas las secciones
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            // Mostrar seleccionada
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Actualizar botones de navegaci√≥n visualmente
            const buttons = document.querySelectorAll('.tab-btn');
            if(tabName === 'comida') buttons[0].classList.add('active');
            if(tabName === 'estaciones') buttons[1].classList.add('active');
            if(tabName === 'eventos') buttons[2].classList.add('active');

            // Mostrar/Ocultar barra inferior de comida
            if(tabName === 'comida') {
                document.getElementById('bottom-bar-food').style.display = 'flex';
            } else {
                document.getElementById('bottom-bar-food').style.display = 'none';
            }
        };

        // --- 2. L√ìGICA COMIDA ---
        onValue(ref(db, 'menu'), (snap) => {
            menuData = snap.val() || {};
            renderMenu();
        });

        function renderMenu() {
            const container = document.getElementById('menu-container');
            container.innerHTML = "";
            for(let id in menuData) {
                if(!menuData[id].existencia) continue;
                const item = menuData[id];
                container.innerHTML += `
                    <div class="food-card" id="card-${id}" onclick="addFood('${id}')">
                        <div class="badge" id="badge-${id}">0</div>
                        <img src="${item.img || 'https://via.placeholder.com/150/000?text=XDR'}" class="food-img">
                        <div class="food-info">
                            <div class="food-title">${item.nombre}</div>
                            <div class="food-price">$${item.precio}</div>
                        </div>
                    </div>
                `;
            }
            updateCartUI();
        }

        window.addFood = (id) => {
            if(!carrito[id]) carrito[id] = 0;
            carrito[id]++;
            updateCartUI();
        };

        function updateCartUI() {
            let total = 0;
            for(let id in menuData) {
                const qty = carrito[id] || 0;
                const badge = document.getElementById(`badge-${id}`);
                const card = document.getElementById(`card-${id}`);
                
                if(badge && card) {
                    if(qty > 0) {
                        badge.style.display = 'block';
                        badge.innerText = qty;
                        card.classList.add('selected');
                        total += menuData[id].precio * qty;
                    } else {
                        badge.style.display = 'none';
                        card.classList.remove('selected');
                    }
                }
            }
            document.getElementById('total-display').innerText = `$${total.toFixed(2)}`;
        }

        // --- 3. GESTI√ìN DEL MODAL ---
        
        // A) ABRIR PARA COMIDA
        window.abrirModalComida = () => {
            if(Object.keys(carrito).length === 0) return alert("Selecciona productos primero.");
            currentMode = 'comida';
            document.getElementById('modal-title').innerText = "ENVIAR PEDIDO";
            document.getElementById('modal-summary').innerText = `Total a pagar: ${document.getElementById('total-display').innerText}`;
            document.getElementById('extra-fields-station').style.display = 'none';
            document.getElementById('main-modal').style.display = 'flex';
        };

        // B) ABRIR PARA ESTACI√ìN
        window.prepararReservaEstacion = (nombrePC) => {
            currentMode = 'estacion';
            contextData = nombrePC;
            document.getElementById('modal-title').innerText = "RESERVAR " + nombrePC;
            document.getElementById('modal-summary').innerText = "Completa fecha y hora de tu sesi√≥n.";
            document.getElementById('extra-fields-station').style.display = 'block'; // Mostrar campos fecha
            document.getElementById('main-modal').style.display = 'flex';
        };

        // C) ABRIR PARA EVENTO
        window.prepararInscripcion = (nombreEvento) => {
            currentMode = 'evento';
            contextData = nombreEvento;
            document.getElementById('modal-title').innerText = "INSCRIPCI√ìN";
            document.getElementById('modal-summary').innerText = nombreEvento;
            document.getElementById('extra-fields-station').style.display = 'none';
            document.getElementById('main-modal').style.display = 'flex';
        };

        window.cerrarModal = () => {
            document.getElementById('main-modal').style.display = 'none';
        };

        // --- 4. ENVIAR A CENTRAL (FIREBASE) ---
        window.enviarDatosCentral = () => {
            const nombre = document.getElementById('cli_nombre').value;
            const cedula = document.getElementById('cli_cedula').value;
            const whatsapp = document.getElementById('cli_whatsapp').value;

            if(!nombre || !cedula || !whatsapp) return alert("Completa tus datos personales.");

            let dataToSend = {
                cliente: nombre,
                cedula: cedula,
                whatsapp: whatsapp,
                timestamp: Date.now(),
                estado: 'pendiente'
            };
            let rutaFirebase = '';

            if(currentMode === 'comida') {
                rutaFirebase = 'pedidos';
                dataToSend.items = carrito;
                dataToSend.total = document.getElementById('total-display').innerText;
                dataToSend.tipo = "Comida R√°pida";
            } 
            else if (currentMode === 'estacion') {
                const fecha = document.getElementById('res_fecha').value;
                const horas = document.getElementById('res_horas').value;
                if(!fecha) return alert("Selecciona Fecha y Hora");
                
                rutaFirebase = 'reservas_estaciones';
                dataToSend.estacion = contextData;
                dataToSend.fecha_inicio = fecha;
                dataToSend.duracion_horas = horas;
                dataToSend.tipo = "Reserva PC/Consola";
            }
            else if (currentMode === 'evento') {
                rutaFirebase = 'reservas_eventos';
                dataToSend.evento = contextData;
                dataToSend.tipo = "Inscripci√≥n Torneo";
            }

            // ENVIAR
            push(ref(db, rutaFirebase), dataToSend)
            .then(() => {
                alert("¬°ENVIADO A LA CENTRAL! Te contactaremos al WhatsApp.");
                location.reload();
            })
            .catch((e) => alert("Error: " + e.message));
        };

    </script>
</body>
</html>
